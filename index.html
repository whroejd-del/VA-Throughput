<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVR VA Throughput Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .progress-bar { transition: width 0.3s ease, background-color 0.3s ease; }
        .engine-card { border-left: 4px solid #f1f5f9; transition: all 0.2s; }
        .engine-active { border-left-color: #3b82f6; background-color: #eff6ff; }
        .dv-active { border-left-color: #f97316; background-color: #fff7ed; }
        .bg-overload { background-color: #dc2626 !important; }
    </style>
</head>
<body class="bg-[#f8fafc] p-8 font-sans">
    <div class="max-w-7xl mx-auto flex gap-8">
        
        <div class="w-80 shrink-0 space-y-6">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <div class="flex items-center gap-2 mb-6 text-blue-600">
                    <span class="text-xl">⚙️</span>
                    <h2 class="font-bold text-gray-800 text-lg">NVR Configuration</h2>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-500 mb-2">NVR Model</label>
                        <select id="modelSelect" class="w-full p-3 border border-gray-200 rounded-xl text-sm font-medium bg-gray-50" onchange="initNVR()">
                            <option value="3200,32">DR-8564 / 8564D (3200 TP)</option>
                            <option value="1600,16">DR-8532 / 8532D / 8516 (1600 TP)</option>
                            <option value="1600,16">DR-6532 / 6516 / 6508 (1600 TP)</option>
                            <option value="800,8">DR-2516 / 2508 (800 TP)</option>
                            <option value="400,4">DR-2504 (400 TP)</option>
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-3 pt-2 text-sm">
                        <div class="flex justify-between text-gray-400"><span>Max Throughput</span><span id="maxTP" class="font-bold text-gray-700">3200</span></div>
                        <div class="flex justify-between text-gray-400"><span>Available VA Engines</span><span id="maxUnits" class="font-bold text-blue-600">32 Units</span></div>
                    </div>
                </div>
            </div>

            <div id="statusPanel" class="bg-[#262f3f] p-6 rounded-2xl shadow-xl text-white transition-colors duration-300">
                <div class="flex items-center gap-2 mb-6">
                    <span id="statusIcon">✔️</span>
                    <h2 class="font-bold text-sm uppercase tracking-wider">System Load Analysis</h2>
                </div>
                
                <div class="flex justify-between items-end mb-2">
                    <span class="text-3xl font-bold"><span id="usagePercent">0</span>%</span>
                    <span class="text-xs opacity-70"><span id="currentTP">0</span> / <span id="targetTP">3200</span></span>
                </div>
                
                <div class="w-full bg-black/20 h-2.5 rounded-full overflow-hidden mb-8">
                    <div id="tpBar" class="progress-bar bg-[#4ade80] h-full w-0"></div>
                </div>
                
                <div class="space-y-4 text-sm border-t border-white/10 pt-6">
                    <div class="flex justify-between opacity-80"><span>Connected Cameras</span><span id="camCount" class="font-bold">0</span></div>
                    <div class="flex justify-between opacity-80"><span>Required VA Engines</span><span id="engineCount" class="font-bold">0 / 32</span></div>
                </div>
                
                <div id="statusMsg" class="mt-8 text-center text-[11px] font-bold py-2 rounded-lg bg-white/10 text-green-400 border border-green-500/20">
                    ✓ System is operational.
                </div>
            </div>

            <div class="bg-[#f1f5f9] p-6 rounded-2xl border border-blue-100 text-blue-800">
                <div class="flex items-center gap-2 mb-4">
                    <span class="text-sm">ⓘ</span>
                    <h3 class="font-bold text-sm">Notes</h3>
                </div>
                <ul class="text-[11px] leading-relaxed space-y-2 list-disc ml-3">
                    <li>1 VA Engine = 100 Throughput</li>
                    <li>Each analytic feature (Object, Face, etc.) consumes 1 VA engine unit.</li>
                    <li>Combined features consume multiple engine units accordingly.</li>
                    <li>NVR throughput may vary by firmware. Maintaining a resource buffer is recommended.</li>
                </ul>
            </div>
        </div>

        <div class="flex-1">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800 tracking-tight">Camera Configuration <span id="camTotalText" class="text-blue-600 ml-1">(0)</span></h2>
                <button onclick="addCamera()" class="bg-blue-600 text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-700 shadow-lg shadow-blue-600/20 transition-all">+ Add Camera</button>
            </div>
            
            <div id="cameraGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                </div>
        </div>
    </div>

    <script>
        let maxTP = 3200, maxUnits = 32, cameras = [];

        function initNVR() {
            const [tp, unit] = document.getElementById('modelSelect').value.split(',').map(Number);
            maxTP = tp; maxUnits = unit;
            document.getElementById('maxTP').innerText = tp;
            document.getElementById('maxUnits').innerText = unit + " Units";
            document.getElementById('targetTP').innerText = tp;
            render();
        }

        function addCamera() {
            if (cameras.length >= 64) return;
            cameras.push({
                id: Date.now(),
                obj: { on: false, at: false, me: false },
                face: { on: false, at: false, me: false },
                aba: false, fall: false, crowd: false, dv1304: false
            });
            render();
        }

        function removeCamera(id) {
            cameras = cameras.filter(c => c.id !== id);
            render();
        }

        function toggle(camId, type, sub = null) {
            const cam = cameras.find(c => c.id === camId);
            if (sub) {
                if (cam[type].on) cam[type][sub] = !cam[type][sub];
            } else if (typeof cam[type] === 'object') {
                cam[type].on = !cam[type].on;
                if (!cam[type].on) { cam[type].at = false; cam[type].me = false; }
            } else {
                cam[type] = !cam[type];
            }
            render();
        }

        function render() {
            const grid = document.getElementById('cameraGrid');
            grid.innerHTML = '';
            let totalTP = 0, totalUnits = 0;

            cameras.forEach((cam, idx) => {
                let cTP = 0, cU = 0;
                if (cam.obj.on) { cTP += 100; cU++; if(cam.obj.at) cTP += 100; if(cam.obj.me) cTP += 100; }
                if (cam.face.on) { cTP += 100; cU++; if(cam.face.at) cTP += 100; if(cam.face.me) cTP += 100; }
                if (cam.aba) { cTP += 100; cU++; }
                if (cam.fall) { cTP += 100; cU++; }
                if (cam.crowd) { cTP += 100; cU++; }
                if (cam.dv1304) { cTP += 100; cU++; }
                totalTP += cTP; totalUnits += cU;

                grid.innerHTML += `
                    <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm relative">
                        <div class="flex justify-between items-center mb-6 pb-2 border-b border-gray-50">
                            <h3 class="font-bold text-gray-700 text-sm uppercase tracking-wider">Camera ${idx + 1}</h3>
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full">${cTP} VA</span>
                                <button onclick="removeCamera(${cam.id})" class="text-gray-300 hover:text-red-500 ml-2">✕</button>
                            </div>
                        </div>
                        <div class="space-y-3">
                            ${renderEngineRow(cam.id, 'obj', 'Object Engine', cam.obj)}
                            ${renderEngineRow(cam.id, 'face', 'Face Engine', cam.face)}
                            ${renderSimpleEngineRow(cam.id, 'aba', 'Abandoned / Removed', cam.aba)}
                            ${renderSimpleEngineRow(cam.id, 'fall', 'Fall Detection', cam.fall)}
                            ${renderSimpleEngineRow(cam.id, 'crowd', 'Crowd Detection', cam.crowd)}
                            ${renderSimpleEngineRow(cam.id, 'dv1304', 'DV-1304 (AI Box)', cam.dv1304, true)}
                        </div>
                    </div>
                `;
            });
            updateDashboard(totalTP, totalUnits);
        }

        function renderEngineRow(id, key, label, state) {
            return `
                <div class="p-3 rounded-2xl engine-card ${state.on ? 'engine-active' : ''}">
                    <label class="flex items-center gap-3 text-sm font-semibold cursor-pointer">
                        <input type="checkbox" ${state.on ? 'checked' : ''} onchange="toggle(${id}, '${key}')" class="w-4 h-4 rounded border-gray-300 text-blue-600"> ${label}
                    </label>
                    <div class="ml-7 mt-2 flex gap-4 text-[11px] ${!state.on ? 'opacity-20 pointer-events-none' : ''}">
                        <label class="flex items-center gap-1.5 cursor-pointer text-gray-500"><input type="checkbox" ${state.at ? 'checked' : ''} onchange="toggle(${id}, '${key}', 'at')"> Attribute</label>
                        <label class="flex items-center gap-1.5 cursor-pointer text-gray-500"><input type="checkbox" ${state.me ? 'checked' : ''} onchange="toggle(${id}, '${key}', 'me')"> Metadata</label>
                    </div>
                </div>
            `;
        }

        function renderSimpleEngineRow(id, key, label, isActive, isSpecial = false) {
            const activeClass = isSpecial ? 'dv-active' : 'engine-active';
            const textColor = isSpecial ? 'text-orange-600' : 'text-gray-700';
            const checkColor = isSpecial ? 'text-orange-500' : 'text-blue-600';

            return `
                <div class="p-3 rounded-2xl engine-card ${isActive ? activeClass : ''}">
                    <label class="flex items-center gap-3 text-sm font-semibold cursor-pointer ${textColor}">
                        <input type="checkbox" ${isActive ? 'checked' : ''} onchange="toggle(${id}, '${key}')" class="w-4 h-4 rounded border-gray-300 ${checkColor}"> ${label}
                    </label>
                </div>
            `;
        }

        function updateDashboard(load, units) {
            const percent = Math.round((load / maxTP) * 100);
            const isOver = load > maxTP || units > maxUnits;
            
            document.getElementById('usagePercent').innerText = percent;
            document.getElementById('currentTP').innerText = load;
            document.getElementById('camCount').innerText = cameras.length;
            document.getElementById('camTotalText').innerText = `(${cameras.length})`;
            document.getElementById('engineCount').innerText = units + " / " + maxUnits;
            
            const bar = document.getElementById('tpBar');
            bar.style.width = Math.min(percent, 100) + "%";
            
            const panel = document.getElementById('statusPanel');
            const msg = document.getElementById('statusMsg');
            const icon = document.getElementById('statusIcon');

            if (isOver) {
                panel.classList.add('bg-overload');
                bar.classList.replace('bg-[#4ade80]', 'bg-white');
                msg.innerText = "⚠ PERFORMANCE EXCEEDED! REDUCE LOAD.";
                msg.className = "mt-8 text-center text-[10px] font-bold py-2 rounded-lg bg-black/20 text-white border border-white/30";
                icon.innerText = "⚠️";
            } else {
                panel.classList.remove('bg-overload');
                bar.classList.replace('bg-white', 'bg-[#4ade80]');
                msg.innerText = "✓ System is operational.";
                msg.className = "mt-8 text-center text-[11px] font-bold py-2 rounded-lg bg-white/10 text-green-400 border border-green-500/20";
                icon.innerText = "✔️";
            }
        }
        initNVR();
    </script>
</body>
</html>
